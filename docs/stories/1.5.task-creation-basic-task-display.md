# Story 1.5: Task Creation and Basic Task Display

## Status
Draft

## Story
**As a** user,
**I want** to create tasks and see them displayed on the kanban board,
**so that** I can start organizing my work.

## Acceptance Criteria

1. Quick-add button/keyboard shortcut allows rapid task creation
2. Task creation form/modal collects: title (required), description (optional), due date (optional), priority (optional), tags (optional)
3. New task is added to specified column (default: Backlog)
4. Task card displays on kanban board with title prominently visible
5. Task card shows basic information: title, due date (if set), priority indicator (if set)
6. Task creation persists to IndexedDB immediately
7. Task appears on board immediately after creation (no page refresh needed)
8. Task creation form validates required fields and shows error messages
9. User can cancel task creation without saving
10. Task cards are visually distinct and readable

## Tasks / Subtasks

- [ ] Task 1: Create Task type definition (AC: 4, 5)
  - [ ] Verify `src/types/task.ts` exists (created in Story 1.2)
  - [ ] Ensure Task interface matches data model from architecture docs
  - [ ] Export type for use in components and repositories

- [ ] Task 2: Verify TaskRepository exists (AC: 6)
  - [ ] Verify `src/services/data/repositories/TaskRepository.ts` exists (created in Story 1.2)
  - [ ] Ensure TaskRepository has `create` method
  - [ ] Ensure TaskRepository methods use async/await pattern

- [ ] Task 3: Create TaskContext for state management (AC: 6, 7)
  - [ ] Create `src/contexts/TaskContext.tsx`
  - [ ] Implement TaskProvider component
  - [ ] Manage tasks state (loading, error, tasks array)
  - [ ] Provide methods: createTask, updateTask, deleteTask, getTasksByColumnId
  - [ ] Load tasks from IndexedDB on mount
  - [ ] Persist changes to IndexedDB automatically
  - [ ] Ensure optimistic updates for better UX
  - [ ] Filter tasks by columnId for display

- [ ] Task 4: Create TaskForm component (AC: 2, 8, 9)
  - [ ] Create `src/components/task/TaskForm.tsx`
  - [ ] Implement form with fields:
    - [ ] Title (required, text input, auto-focus)
    - [ ] Description (optional, textarea)
    - [ ] Due date (optional, date picker)
    - [ ] Priority (optional, select: low/medium/high)
    - [ ] Tags (optional, multi-select or comma-separated input)
    - [ ] Column selection (dropdown, default: Backlog)
  - [ ] Add form validation (title required)
  - [ ] Show validation error messages inline
  - [ ] Add "Create Task" button (primary action)
  - [ ] Add "Cancel" button (secondary action)
  - [ ] Handle form submission
  - [ ] Handle form cancellation
  - [ ] Ensure form is accessible (ARIA labels, keyboard navigation)

- [ ] Task 5: Create TaskCreationModal component (AC: 2, 8, 9)
  - [ ] Create `src/components/task/TaskCreationModal.tsx`
  - [ ] Use TaskForm component inside modal
  - [ ] Implement modal overlay with backdrop
  - [ ] Handle modal open/close state
  - [ ] Close on ESC key press
  - [ ] Close on backdrop click (optional, configurable)
  - [ ] Focus management (trap focus, return focus on close)
  - [ ] Ensure modal is accessible (ARIA modal attributes)

- [ ] Task 6: Implement quick-add button (AC: 1)
  - [ ] Add "Add Task" button to board header or navigation
  - [ ] Button opens TaskCreationModal
  - [ ] Ensure button is visible and accessible
  - [ ] Add keyboard shortcut support (Cmd/Ctrl + N or T)
  - [ ] Handle keyboard shortcut globally
  - [ ] Show tooltip with keyboard shortcut hint

- [ ] Task 7: Implement column-specific add button (AC: 1, 3)
  - [ ] Add "+" button to ColumnHeader component (from Story 1.4)
  - [ ] Button opens TaskCreationModal with column pre-selected
  - [ ] Ensure button is accessible (ARIA label)
  - [ ] Style button appropriately

- [ ] Task 8: Create TaskCard component (AC: 4, 5, 10)
  - [ ] Create `src/components/kanban/TaskCard.tsx`
  - [ ] Display task title prominently
  - [ ] Display due date if set (with calendar icon)
  - [ ] Display priority indicator if set (color-coded badge)
  - [ ] Style card with Tailwind CSS:
    - [ ] Rounded corners
    - [ ] Subtle shadow
    - [ ] Adequate padding
    - [ ] Hover state (elevated shadow)
  - [ ] Ensure card is visually distinct and readable
  - [ ] Ensure card is accessible (ARIA labels, keyboard navigation)
  - [ ] Make card clickable (for future detail view)

- [ ] Task 9: Integrate TaskCard into Column component (AC: 4, 5, 7)
  - [ ] Update `src/components/kanban/Column.tsx` (from Story 1.4)
  - [ ] Use TaskContext to get tasks for column
  - [ ] Filter tasks by columnId
  - [ ] Render TaskCard for each task
  - [ ] Display tasks in order (by position)
  - [ ] Ensure tasks appear immediately after creation (no refresh)

- [ ] Task 10: Implement task creation flow (AC: 3, 6, 7)
  - [ ] Handle form submission in TaskForm
  - [ ] Call TaskContext.createTask with form data
  - [ ] Set default columnId to "Backlog" if not specified
  - [ ] Set default position (next available position in column)
  - [ ] Set default values: isBillable: false, tags: [], etc.
  - [ ] Generate UUID for task id
  - [ ] Set createdAt and updatedAt timestamps
  - [ ] Persist task to IndexedDB via TaskRepository
  - [ ] Update TaskContext state optimistically
  - [ ] Close modal after successful creation
  - [ ] Show success feedback (optional: brief highlight animation)

- [ ] Task 11: Implement form validation (AC: 8)
  - [ ] Validate title is required and not empty
  - [ ] Show inline error message for title validation
  - [ ] Validate due date format (if provided)
  - [ ] Validate priority is one of: low, medium, high, null
  - [ ] Prevent form submission if validation fails
  - [ ] Show validation errors clearly
  - [ ] Ensure accessible error messages (ARIA live regions)

- [ ] Task 12: Implement date picker for due date (AC: 2)
  - [ ] Use HTML5 date input or date picker library
  - [ ] Ensure date picker is accessible
  - [ ] Handle date formatting and parsing
  - [ ] Store date as Date object in Task model

- [ ] Task 13: Implement priority selector (AC: 2, 5)
  - [ ] Create priority selector component or use select input
  - [ ] Options: Low, Medium, High, None
  - [ ] Style priority selector appropriately
  - [ ] Ensure accessible (keyboard navigation, ARIA labels)

- [ ] Task 14: Implement priority indicator on TaskCard (AC: 5)
  - [ ] Create PriorityBadge component
  - [ ] Display priority as color-coded badge:
    - [ ] High: Red badge
    - [ ] Medium: Orange badge
    - [ ] Low: Grey badge
  - [ ] Only display if priority is set
  - [ ] Ensure badge is accessible (ARIA label)

- [ ] Task 15: Implement due date display on TaskCard (AC: 5)
  - [ ] Format due date for display (e.g., "Jan 24", "Tomorrow", "Today")
  - [ ] Display calendar icon with date
  - [ ] Only display if due date is set
  - [ ] Ensure date display is accessible

- [ ] Task 16: Implement tags input (AC: 2)
  - [ ] Create tags input component
  - [ ] Allow comma-separated input or multi-select
  - [ ] Display tags as chips/badges
  - [ ] Store tags as string array in Task model
  - [ ] Ensure tags input is accessible

- [ ] Task 17: Update task count in ColumnHeader (AC: 7)
  - [ ] Update ColumnHeader component (from Story 1.4)
  - [ ] Use TaskContext to get task count for column
  - [ ] Display task count badge
  - [ ] Update count immediately when task is created

- [ ] Task 18: Implement keyboard shortcuts (AC: 1)
  - [ ] Create keyboard shortcut handler utility
  - [ ] Register Cmd/Ctrl + N or T for "Add Task"
  - [ ] Handle keyboard shortcuts globally
  - [ ] Prevent default browser behavior
  - [ ] Show keyboard shortcut hints in UI

- [ ] Task 19: Style TaskCard with Tailwind CSS (AC: 10)
  - [ ] Apply consistent styling to task cards
  - [ ] Use rounded corners and subtle shadows
  - [ ] Ensure adequate spacing
  - [ ] Match design system from front-end spec
  - [ ] Support dark mode (if implemented)
  - [ ] Ensure cards are visually distinct from columns

- [ ] Task 20: Testing and verification (AC: 1-10)
  - [ ] Test quick-add button opens modal
  - [ ] Test keyboard shortcut opens modal
  - [ ] Test column-specific add button
  - [ ] Test task creation with all fields
  - [ ] Test task creation with minimal fields (title only)
  - [ ] Test form validation (empty title)
  - [ ] Test form cancellation
  - [ ] Test task appears on board immediately
  - [ ] Test task persists to IndexedDB
  - [ ] Test task card displays correctly
  - [ ] Test priority indicator display
  - [ ] Test due date display
  - [ ] Test task count updates
  - [ ] Verify all acceptance criteria are met

- [ ] Task 21: Code quality and accessibility (AC: 10)
  - [ ] Ensure all components use TypeScript (no `any`)
  - [ ] Add ARIA labels to interactive elements
  - [ ] Ensure semantic HTML structure
  - [ ] Test with screen reader
  - [ ] Ensure keyboard navigation works
  - [ ] Add JSDoc comments to components
  - [ ] Run linter and fix any issues
  - [ ] Ensure code follows component template pattern

## Dev Notes

### Previous Story Insights
[Source: Story 1.1, Story 1.2, Story 1.4]

**Key Learnings from Story 1.1:**
- Project structure is established: `src/components/`, `src/contexts/`, `src/hooks/`
- Vite ^5.0.0 is configured as build tool
- TypeScript is configured with strict mode and path aliases (@/ for src/)
- Tailwind CSS ^3.4.0 is configured for styling
- Project uses React ^18.2.0, TypeScript ^5.3.0

**Key Learnings from Story 1.2:**
- IndexedDB is set up with Dexie.js ^3.2.4
- TaskRepository is implemented with CRUD operations
- Task data model is defined
- Database operations use async/await pattern

**Key Learnings from Story 1.4:**
- ColumnContext is implemented for column state management
- KanbanBoard and Column components are created
- Columns are stored in IndexedDB
- Default columns: Backlog, In Progress, Review, Done

**Important Notes:**
- TaskRepository already exists (created in Story 1.2)
- Task type definition already exists (created in Story 1.2)
- Need to create TaskContext for state management
- Need to integrate with ColumnContext from Story 1.4
- Tasks must be filtered by columnId for display

### Tech Stack Requirements
[Source: architecture/common/tech-stack.md]

**Critical Versions:**
- React: ^18.2.0 (already installed)
- TypeScript: ^5.3.0 (already installed)
- Tailwind CSS: ^3.4.0 (already installed)
- Dexie.js: ^3.2.4 (already installed)

**No Additional Dependencies Required:**
- Use native HTML5 date input for due date
- Use native select/input for priority and tags
- No external form library needed for MVP

### Data Models
[Source: architecture/common/data-models.md#task]

**Task Interface:**
```typescript
interface Task {
  id: string;
  title: string;
  description?: string;
  columnId: string;
  position: number;
  clientId: string | null;
  projectId: string | null;
  isBillable: boolean;
  hourlyRate: number | null;
  timeEstimate: number | null; // in minutes
  dueDate: Date | null;
  priority: 'low' | 'medium' | 'high' | null;
  tags: string[];
  createdAt: Date;
  updatedAt: Date;
}
```

**Key Attributes for Story 1.5:**
- `title`: string - Required, task title
- `description`: string - Optional, detailed description
- `columnId`: string - Required, column task belongs to (default: Backlog)
- `position`: number - Position within column (for ordering)
- `dueDate`: Date | null - Optional, task due date
- `priority`: 'low' | 'medium' | 'high' | null - Optional, priority level
- `tags`: string[] - Optional, array of tag strings

**Default Values:**
- `isBillable`: false
- `clientId`: null
- `projectId`: null
- `hourlyRate`: null
- `timeEstimate`: null
- `tags`: []

### Repository Pattern
[Source: Story 1.2, architecture/common/coding-standards.md]

**TaskRepository Methods (Already Implemented):**
- `create(task: Omit<Task, 'id' | 'createdAt' | 'updatedAt'>): Promise<Task>`
- `getById(id: string): Promise<Task | undefined>`
- `getAll(): Promise<Task[]>`
- `getByColumnId(columnId: string): Promise<Task[]>`
- `update(id: string, updates: Partial<Task>): Promise<Task>`
- `delete(id: string): Promise<void>`

**Critical Rule:**
- Always use repository pattern, never access IndexedDB directly from components
- Components must use TaskRepository via TaskContext

### State Management Architecture
[Source: architecture/common/frontend-architecture.md#state-management-architecture]

**TaskContext Structure:**
```typescript
interface TaskState {
  tasks: Task[];
  loading: boolean;
  error: Error | null;
}
```

**State Management Patterns:**
- **Context Provider:** TaskContext manages task state
- **Custom Hooks:** Business logic encapsulated in custom hooks
- **Optimistic Updates:** UI updates immediately, then syncs with IndexedDB
- **Error Boundaries:** React Error Boundaries catch component errors gracefully
- **Memoization:** Use `React.memo`, `useMemo`, and `useCallback` to prevent unnecessary re-renders

**TaskContext Methods:**
- `createTask(taskData: Omit<Task, 'id' | 'createdAt' | 'updatedAt'>): Promise<Task>`
- `updateTask(id: string, updates: Partial<Task>): Promise<Task>`
- `deleteTask(id: string): Promise<void>`
- `getTasksByColumnId(columnId: string): Task[]`
- `getTaskById(id: string): Task | undefined`

**Integration with ColumnContext:**
- TaskContext loads tasks on mount
- Tasks are filtered by columnId for display
- ColumnContext provides columns for task assignment

### Component Architecture
[Source: architecture/common/frontend-architecture.md#component-architecture]

**Component Organization:**
```
src/components/
├── kanban/
│   ├── KanbanBoard.tsx      # Already exists (Story 1.4)
│   ├── Column.tsx           # Already exists (Story 1.4)
│   └── TaskCard.tsx          # New component
└── task/
    ├── TaskForm.tsx          # New component
    └── TaskCreationModal.tsx # New component
```

**Component Template:**
```typescript
import React from 'react';
import { useTaskContext } from '@/contexts/TaskContext';

interface ComponentProps {
  // Props definition
}

export const Component: React.FC<ComponentProps> = ({ ...props }) => {
  const { tasks, createTask } = useTaskContext();
  
  // Component logic
  
  return (
    <div className="...">
      {/* JSX */}
    </div>
  );
};
```

### Task Card Design
[Source: front-end-spec, PRD]

**Task Card Elements (Basic Display for Story 1.5):**
- Task title (prominent, readable font)
- Due date (if set, with calendar icon)
- Priority indicator (if set, color-coded badge)

**Task Card States:**
- Default: White background, subtle border, standard elevation
- Hover: Increased shadow, slight scale (1.02x), cursor pointer
- Clickable: Opens detail view (for future story)

**Visual Design:**
- Rounded corners on cards
- Subtle shadow effects for depth
- Adequate spacing between cards (12-16px)
- Minimum card height: ~120px
- Consistent padding (16-24px)

**Priority Badge Colors:**
- High: Red badge
- Medium: Orange badge
- Low: Grey badge

### Task Creation Form
[Source: front-end-spec, Epic 1.5 Acceptance Criteria]

**Form Fields:**
- **Required:** Task title (prominent, auto-focus)
- **Optional:** Description, Due date, Priority, Tags, Column selection

**Form Layout:**
- Progressive disclosure (show basic fields first)
- Smart defaults (pre-select current column or Backlog)
- Inline validation with error messages
- Keyboard shortcuts (Enter to save, ESC to cancel)

**Modal Behavior:**
- Opens as modal overlay
- Dims background board
- Click outside or ESC to close
- Focus management (trap focus, return focus on close)

### Keyboard Shortcuts
[Source: Epic 1.5 Acceptance Criteria, PRD]

**Shortcut for Add Task:**
- Cmd/Ctrl + N or T (to be determined)
- Global keyboard handler
- Show tooltip with shortcut hint

**Form Shortcuts:**
- Enter: Submit form (if valid)
- ESC: Cancel form, close modal
- Tab: Navigate between fields

### Form Validation
[Source: Epic 1.5 Acceptance Criteria]

**Validation Rules:**
- Title: Required, cannot be empty
- Due date: Must be valid date format (if provided)
- Priority: Must be one of: low, medium, high, null

**Error Display:**
- Inline error messages below fields
- Accessible error messages (ARIA live regions)
- Prevent form submission if validation fails

### Project Structure
[Source: architecture/unified-project-structure.md]

**File Locations:**
- Components: `src/components/kanban/TaskCard.tsx`, `src/components/task/TaskForm.tsx`, `src/components/task/TaskCreationModal.tsx`
- Context: `src/contexts/TaskContext.tsx`
- Repository: `src/services/data/repositories/TaskRepository.ts` (already exists)
- Types: `src/types/task.ts` (already exists)
- Tests: `tests/unit/components/kanban/`, `tests/unit/components/task/`, `tests/unit/contexts/`

### Coding Standards
[Source: architecture/common/coding-standards.md]

**Critical Rules:**
- **Type Safety:** Always use TypeScript types/interfaces, avoid `any`
- **Component Organization:** One component per file, co-locate related components
- **State Management:** Use Context API, avoid prop drilling beyond 2 levels
- **Data Access:** Always use repository pattern, never access IndexedDB directly from components
- **Error Handling:** All async operations must have try/catch
- **Performance:** Use React.memo, useMemo, useCallback appropriately
- **Accessibility:** All interactive elements must have ARIA labels, keyboard navigation support

**Naming Conventions:**
- Components: PascalCase (e.g., `TaskCard.tsx`, `TaskForm.tsx`)
- Context: PascalCase (e.g., `TaskContext.tsx`)
- Hooks: camelCase with 'use' prefix (e.g., `useTask.ts`)
- Types/Interfaces: PascalCase (e.g., `Task`)

### Accessibility Requirements
[Source: architecture/common/accessibility-implementation.md, PRD]

**WCAG 2.1 AA Compliance:**
- Keyboard navigation for all interactive elements
- Screen reader compatibility
- Focus indicators for keyboard navigation
- ARIA labels for interactive elements
- Semantic HTML structure

**ARIA Implementation:**
```typescript
// Task card
<div role="article" aria-labelledby={`task-${task.id}-title`}>
  <h3 id={`task-${task.id}-title`}>{task.title}</h3>
</div>

// Modal
<div role="dialog" aria-labelledby="task-creation-title" aria-modal="true">
  <h2 id="task-creation-title">Create New Task</h2>
  {/* Form */}
</div>

// Form field
<label htmlFor="task-title">Task Title</label>
<input
  id="task-title"
  aria-required="true"
  aria-invalid={hasError}
  aria-describedby={hasError ? "title-error" : undefined}
/>
```

**Keyboard Navigation:**
- Tab: Move between form fields
- Enter: Submit form (if valid)
- ESC: Cancel form, close modal
- Arrow keys: Navigate between tasks (for future story)

### Testing Requirements
[Source: architecture/common/testing-strategy.md]

**Test Organization:**
- Unit tests: `tests/unit/components/kanban/`, `tests/unit/components/task/`, `tests/unit/contexts/`
- Integration tests: `tests/integration/` (TaskContext integration)
- E2E tests: `tests/e2e/` (task creation workflow)

**Testing Frameworks:**
- Jest ^29.7.0 for unit testing
- React Testing Library ^14.0.0 for component testing
- Playwright ^1.40.0 for E2E testing

**Test Standards:**
- Write tests for all CRUD operations
- Test form validation
- Test keyboard shortcuts
- Test modal behavior
- Use descriptive test names
- Follow Arrange-Act-Assert pattern

**Test Examples:**

**Component Test Example:**
```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { TaskContextProvider } from '@/contexts/TaskContext';
import { ColumnContextProvider } from '@/contexts/ColumnContext';
import { TaskForm } from '@/components/task/TaskForm';

describe('TaskForm', () => {
  it('validates required title field', async () => {
    render(
      <TaskContextProvider>
        <ColumnContextProvider>
          <TaskForm onClose={() => {}} />
        </ColumnContextProvider>
      </TaskContextProvider>
    );
    
    const submitButton = screen.getByText('Create Task');
    fireEvent.click(submitButton);
    
    expect(await screen.findByText(/title is required/i)).toBeInTheDocument();
  });
});
```

**Context Test Example:**
```typescript
import { renderHook, act } from '@testing-library/react';
import { TaskContextProvider, useTaskContext } from '@/contexts/TaskContext';

describe('TaskContext', () => {
  it('creates a task successfully', async () => {
    const wrapper = ({ children }: { children: React.ReactNode }) => (
      <TaskContextProvider>{children}</TaskContextProvider>
    );
    
    const { result } = renderHook(() => useTaskContext(), { wrapper });
    
    await act(async () => {
      const task = await result.current.createTask({
        title: 'Test Task',
        columnId: 'backlog-1',
        position: 0,
        isBillable: false,
        tags: []
      });
      
      expect(task.id).toBeDefined();
      expect(task.title).toBe('Test Task');
    });
  });
});
```

**E2E Test Example:**
```typescript
import { test, expect } from '@playwright/test';

test('user can create a task', async ({ page }) => {
  await page.goto('http://localhost:5173');
  
  // Click add task button
  await page.click('[data-testid="add-task-button"]');
  
  // Fill form
  await page.fill('[data-testid="task-title-input"]', 'New Task');
  await page.selectOption('[data-testid="task-priority-select"]', 'high');
  
  // Submit form
  await page.click('[data-testid="create-task-button"]');
  
  // Verify task appears on board
  await expect(page.locator('text=New Task')).toBeVisible();
});
```

**Specific Testing Requirements for This Story:**
- Test TaskContext CRUD operations
- Test TaskForm component rendering and validation
- Test TaskCreationModal open/close behavior
- Test TaskCard component rendering
- Test task creation flow (form → context → repository)
- Test task appears on board immediately
- Test task persists to IndexedDB
- Test keyboard shortcuts
- Test form validation
- Test modal accessibility
- Verify all acceptance criteria are met

### Performance Considerations
[Source: PRD, architecture]

**Performance Requirements:**
- Task creation should feel instant (optimistic updates)
- Board should handle many tasks efficiently
- Form should not cause layout shifts

**Optimization Strategies:**
- Use optimistic updates for immediate UI feedback
- Memoize task cards with React.memo
- Use useMemo for filtering tasks by column
- Use useCallback for event handlers
- Avoid unnecessary re-renders

### Technical Constraints
[Source: architecture/common/tech-stack.md, PRD]

- No backend services - frontend-only application
- All data stored in IndexedDB (local-first architecture)
- Tasks persist across browser sessions
- Application works offline (Service Worker from Story 1.3)
- Single page application (no routing)

### Testing

#### Testing Standards
[Source: architecture/common/testing-strategy.md]

**Test File Location:**
- Unit tests: `tests/unit/` directory
- Integration tests: `tests/integration/` directory
- E2E tests: `tests/e2e/` directory

**Testing Frameworks:**
- Jest ^29.7.0 for unit and integration testing
- React Testing Library ^14.0.0 for component testing
- Playwright ^1.40.0 for E2E testing

**Test Standards:**
- Write tests for all CRUD operations
- Test user interactions (form submission, validation)
- Test keyboard shortcuts
- Test modal behavior
- Use descriptive test names
- Follow Arrange-Act-Assert pattern
- Aim for high test coverage (80%+)

**Specific Testing Requirements for This Story:**
- Test TaskContext state management
- Test TaskForm component
- Test TaskCreationModal component
- Test TaskCard component
- Test task creation workflow
- Test form validation
- Test keyboard shortcuts
- Test task persistence
- Test task display on board
- Verify all acceptance criteria are met

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
