# Story 4.7: Onboarding Wizard

## Status
Draft

## Story
**As a** new user,
**I want** a guided onboarding experience,
**so that** I can quickly understand how to use the application.

## Acceptance Criteria

1. Onboarding wizard appears on first application launch
2. Wizard includes welcome screen with value proposition
3. Step 1: Guide user to add first client (with inline creation demo)
4. Step 2: Guide user to create first project (optional, with inline creation demo)
5. Step 3: Guide user to customize board columns (with drag-and-drop demo)
6. Step 4: Guide user to create sample task with timer demo
7. Step 5: Tour of key features (timer, billable toggle, revenue view)
8. Wizard can be skipped (skip button on each step)
9. Wizard can be restarted from settings
10. Wizard progress is saved (if user closes app, resumes from last step)
11. Wizard includes tooltips and highlights key UI elements
12. Wizard provides sample data option (pre-populated board for exploration)
13. User can delete sample data after exploration
14. Wizard is accessible via keyboard navigation

## Tasks / Subtasks

- [ ] Task 1: Create OnboardingContext for wizard state management (AC: 10)
  - [ ] Create `src/contexts/OnboardingContext.tsx`
  - [ ] Manage onboarding state: `currentStep: number`, `isActive: boolean`, `isSkipped: boolean`
  - [ ] Add methods: `startOnboarding()`, `nextStep()`, `previousStep()`, `skipOnboarding()`, `completeOnboarding()`, `getCurrentStep(): number`
  - [ ] Persist onboarding progress to Settings (onboardingCompleted: boolean, onboardingStep: number)
  - [ ] Load onboarding state from Settings on mount
  - [ ] Ensure context updates trigger re-renders

- [ ] Task 2: Extend Settings interface to track onboarding progress (AC: 9, 10)
  - [ ] Update `src/types/settings.ts`
  - [ ] Add `onboardingStep: number` field to Settings interface (current step, 0 = not started, -1 = completed)
  - [ ] Keep existing `onboardingCompleted: boolean` field
  - [ ] Update SettingsRepository if needed (should handle new field automatically)
  - [ ] Ensure backward compatibility (default onboardingStep to 0 if not set)

- [ ] Task 3: Create OnboardingWizard component structure (AC: 1, 8, 11, 14)
  - [ ] Create `src/components/onboarding/OnboardingWizard.tsx`
  - [ ] Implement wizard container with step navigation
  - [ ] Show progress indicator (step X of Y)
  - [ ] Add "Skip" button on each step
  - [ ] Add "Next" and "Previous" buttons (Previous disabled on first step)
  - [ ] Add "Finish" button on last step
  - [ ] Implement tooltip/highlight system for UI elements
  - [ ] Ensure keyboard navigation (Tab, Enter, Arrow keys, ESC to skip)
  - [ ] Add ARIA labels and semantic HTML
  - [ ] Style as modal overlay (full screen or centered modal)

- [ ] Task 4: Create WelcomeStep component (AC: 2)
  - [ ] Create `src/components/onboarding/steps/WelcomeStep.tsx`
  - [ ] Display welcome message and value proposition
  - [ ] Show application logo/branding
  - [ ] Explain what the app does (time tracking, kanban board, revenue tracking)
  - [ ] Show "Get Started" button (goes to Step 1)
  - [ ] Show "Skip" button
  - [ ] Style consistently with wizard design

- [ ] Task 5: Create AddClientStep component (AC: 3, 11)
  - [ ] Create `src/components/onboarding/steps/AddClientStep.tsx`
  - [ ] Display instructions: "Let's add your first client"
  - [ ] Highlight ClientSelector component on kanban board (if visible) or show inline demo
  - [ ] Guide user to click "Create New Client" option
  - [ ] Show tooltip/overlay pointing to client creation UI
  - [ ] Detect when client is created (watch ClientContext)
  - [ ] Auto-advance to next step when client is created
  - [ ] Show "Skip" and "Next" buttons
  - [ ] Allow manual advance if client already exists

- [ ] Task 6: Create AddProjectStep component (AC: 4, 11)
  - [ ] Create `src/components/onboarding/steps/AddProjectStep.tsx`
  - [ ] Display instructions: "Now let's create a project (optional)"
  - [ ] Highlight ProjectSelector component (if client selected)
  - [ ] Guide user to click "Create New Project" option
  - [ ] Show tooltip/overlay pointing to project creation UI
  - [ ] Detect when project is created (watch ProjectContext)
  - [ ] Auto-advance to next step when project is created
  - [ ] Show "Skip" and "Next" buttons (skip is prominent since project is optional)
  - [ ] Allow manual advance if project already exists or user skips

- [ ] Task 7: Create CustomizeColumnsStep component (AC: 5, 11)
  - [ ] Create `src/components/onboarding/steps/CustomizeColumnsStep.tsx`
  - [ ] Display instructions: "Customize your board columns"
  - [ ] Highlight column headers on kanban board
  - [ ] Guide user to drag columns to reorder (if drag-and-drop enabled for columns)
  - [ ] Show tooltip/overlay explaining column customization
  - [ ] Show "Skip" and "Next" buttons
  - [ ] Allow manual advance (no detection needed, just educational)

- [ ] Task 8: Create CreateTaskStep component (AC: 6, 11)
  - [ ] Create `src/components/onboarding/steps/CreateTaskStep.tsx`
  - [ ] Display instructions: "Create your first task and try the timer"
  - [ ] Highlight "Add Task" button or task creation UI
  - [ ] Guide user to create a task
  - [ ] Guide user to start timer on the task
  - [ ] Show tooltip/overlay pointing to timer button
  - [ ] Detect when task is created and timer is started (watch TaskContext and TimerContext)
  - [ ] Auto-advance to next step when task is created and timer started
  - [ ] Show "Skip" and "Next" buttons
  - [ ] Allow manual advance

- [ ] Task 9: Create FeatureTourStep component (AC: 7, 11)
  - [ ] Create `src/components/onboarding/steps/FeatureTourStep.tsx`
  - [ ] Display tour of key features:
    - [ ] Timer functionality (start/stop, background operation)
    - [ ] Billable toggle (explain billable vs non-billable)
    - [ ] Revenue view (navigate to revenue dashboard, show revenue calculation)
  - [ ] Highlight each feature as it's explained
  - [ ] Show tooltips/overlays for each feature
  - [ ] Allow user to interact with features during tour
  - [ ] Show "Finish" button to complete onboarding
  - [ ] Mark onboarding as completed when finished

- [ ] Task 10: Create Tooltip/Highlight system for wizard (AC: 11)
  - [ ] Create `src/components/onboarding/OnboardingTooltip.tsx` component
  - [ ] Create `src/components/onboarding/OnboardingHighlight.tsx` component
  - [ ] Implement tooltip that points to UI elements
  - [ ] Implement highlight overlay that dims background and highlights target element
  - [ ] Support positioning (top, bottom, left, right)
  - [ ] Support arrow/pointer to target element
  - [ ] Ensure tooltips are accessible (ARIA labels, keyboard navigation)
  - [ ] Style consistently with wizard design

- [ ] Task 11: Create SampleDataService for sample data generation (AC: 12, 13)
  - [ ] Create `src/services/SampleDataService.ts`
  - [ ] Implement `generateSampleData(): Promise<void>` method
  - [ ] Create sample clients (2-3 clients with names and rates)
  - [ ] Create sample projects (1-2 projects per client)
  - [ ] Create sample columns (Backlog, In Progress, Review, Done)
  - [ ] Create sample tasks (5-10 tasks across columns, with various properties)
  - [ ] Create sample time entries (for some tasks)
  - [ ] Use repositories to save sample data to IndexedDB
  - [ ] Implement `deleteSampleData(): Promise<void>` method
  - [ ] Mark sample data with flag or prefix (e.g., task title prefix "[Sample]")
  - [ ] Delete all sample data when user chooses to delete

- [ ] Task 12: Add sample data option to WelcomeStep (AC: 12, 13)
  - [ ] Update WelcomeStep component
  - [ ] Add "Try with Sample Data" button/option
  - [ ] When clicked, call SampleDataService.generateSampleData()
  - [ ] Show loading state during sample data generation
  - [ ] After generation, show option to delete sample data
  - [ ] Add "Delete Sample Data" button (visible when sample data exists)
  - [ ] Show confirmation dialog before deleting sample data
  - [ ] After deletion, allow user to continue onboarding or start fresh

- [ ] Task 13: Integrate OnboardingWizard into App.tsx (AC: 1, 10)
  - [ ] Update `src/App.tsx`
  - [ ] Import OnboardingWizard component
  - [ ] Import OnboardingContext
  - [ ] Wrap AppContent with OnboardingProvider
  - [ ] Check SettingsContext for onboardingCompleted flag
  - [ ] Render OnboardingWizard if onboarding not completed
  - [ ] Load onboarding step from Settings
  - [ ] Resume wizard from saved step
  - [ ] Ensure wizard overlays main app content

- [ ] Task 14: Add restart onboarding option to Settings (AC: 9)
  - [ ] Update SettingsPanel component (from Story 4.6)
  - [ ] Add "Onboarding" section
  - [ ] Add "Restart Onboarding" button
  - [ ] Show confirmation dialog before restarting
  - [ ] Reset onboardingCompleted to false and onboardingStep to 0
  - [ ] Trigger OnboardingContext to restart wizard
  - [ ] Ensure wizard appears after restart

- [ ] Task 15: Implement step detection and auto-advance (AC: 3, 4, 6)
  - [ ] Update OnboardingWizard component
  - [ ] Watch ClientContext for client creation (Step 1)
  - [ ] Watch ProjectContext for project creation (Step 2)
  - [ ] Watch TaskContext and TimerContext for task creation and timer start (Step 4)
  - [ ] Auto-advance to next step when step goal is achieved
  - [ ] Show success message when step is completed
  - [ ] Allow manual advance if goal already achieved

- [ ] Task 16: Implement progress persistence (AC: 10)
  - [ ] Update OnboardingContext
  - [ ] Save current step to Settings on each step change
  - [ ] Save onboardingCompleted flag when wizard is completed
  - [ ] Load step from Settings on mount
  - [ ] Resume wizard from saved step
  - [ ] Handle edge cases (invalid step numbers, completed onboarding)

- [ ] Task 17: Ensure keyboard navigation (AC: 14)
  - [ ] Update OnboardingWizard component
  - [ ] Implement keyboard shortcuts:
    - [ ] Tab: Navigate between wizard elements
    - [ ] Enter/Space: Activate buttons
    - [ ] Arrow Left/Right: Navigate between steps (if applicable)
    - [ ] ESC: Skip/close wizard
  - [ ] Ensure focus trap within wizard
  - [ ] Ensure focus management (focus first element on step change)
  - [ ] Test with keyboard-only navigation
  - [ ] Add ARIA labels for keyboard navigation

- [ ] Task 18: Style wizard with consistent design (AC: All)
  - [ ] Update OnboardingWizard component
  - [ ] Use Tailwind CSS for styling
  - [ ] Style wizard as modal overlay (backdrop, centered content)
  - [ ] Style progress indicator
  - [ ] Style navigation buttons
  - [ ] Style tooltips and highlights
  - [ ] Ensure dark mode support (from Story 4.5)
  - [ ] Ensure responsive design (mobile, tablet, desktop)
  - [ ] Add smooth transitions between steps

- [ ] Task 19: Handle edge cases and errors (AC: All)
  - [ ] Update OnboardingWizard component
  - [ ] Handle case where user has existing data (skip to appropriate step)
  - [ ] Handle case where required contexts are not loaded
  - [ ] Handle errors during sample data generation
  - [ ] Handle errors during sample data deletion
  - [ ] Show error messages gracefully
  - [ ] Allow user to continue even if errors occur

- [ ] Task 20: Add unit tests for OnboardingWizard component (AC: All)
  - [ ] Create `tests/unit/components/onboarding/OnboardingWizard.test.tsx`
  - [ ] Test wizard renders correctly
  - [ ] Test step navigation (next, previous, skip)
  - [ ] Test step detection and auto-advance
  - [ ] Test progress persistence
  - [ ] Test keyboard navigation
  - [ ] Mock OnboardingContext and related contexts

- [ ] Task 21: Add unit tests for OnboardingContext (AC: 10)
  - [ ] Create `tests/unit/contexts/OnboardingContext.test.tsx`
  - [ ] Test context state management
  - [ ] Test step navigation methods
  - [ ] Test progress persistence
  - [ ] Test onboarding completion
  - [ ] Mock SettingsContext and SettingsRepository

- [ ] Task 22: Add unit tests for SampleDataService (AC: 12, 13)
  - [ ] Create `tests/unit/services/SampleDataService.test.ts`
  - [ ] Test sample data generation
  - [ ] Test sample data deletion
  - [ ] Test sample data structure
  - [ ] Mock repositories

- [ ] Task 23: Add integration tests for onboarding workflow (AC: All)
  - [ ] Create `tests/integration/OnboardingWorkflow.test.tsx`
  - [ ] Test complete onboarding workflow
  - [ ] Test step detection and auto-advance
  - [ ] Test progress persistence
  - [ ] Test sample data generation and deletion
  - [ ] Test restart from settings
  - [ ] Use React Testing Library with full context providers

- [ ] Task 24: Add E2E tests for onboarding wizard (AC: All)
  - [ ] Create `tests/e2e/onboarding.spec.ts`
  - [ ] Test wizard appears on first launch
  - [ ] Test all wizard steps
  - [ ] Test step detection and auto-advance
  - [ ] Test skip functionality
  - [ ] Test progress persistence across reloads
  - [ ] Test restart from settings
  - [ ] Test sample data generation and deletion
  - [ ] Test keyboard navigation
  - [ ] Use Playwright for E2E testing

## Dev Notes

### Previous Story Insights

From Story 4.5 (Dark Mode):
- Dark mode support should be applied to wizard
- SettingsContext already has onboardingCompleted field

From Story 4.6 (Settings and Preferences Screen):
- SettingsPanel component will exist
- Settings view integration patterns

From Story 3.1 (Client Management):
- ClientSelector and ClientForm components exist for inline client creation
- ClientContext provides createClient method

From Story 3.2 (Project Management):
- ProjectSelector and ProjectForm components exist for inline project creation
- ProjectContext provides createProject method

**Key Integration Points:**
- Story 4.7 creates OnboardingWizard component
- Story 4.7 uses existing ClientSelector, ProjectSelector, TaskForm components
- Story 4.7 uses existing contexts (ClientContext, ProjectContext, TaskContext, TimerContext, SettingsContext)
- Story 4.7 extends Settings interface with onboardingStep field
- Story 4.7 integrates with SettingsPanel for restart option

### Data Models

**Settings Model** (to be extended):
```typescript
interface Settings {
  id: 'default';
  darkMode: boolean;
  defaultBillableStatus: boolean;
  defaultHourlyRate: number | null;
  keyboardShortcuts: Record<string, string>;
  onboardingCompleted: boolean; // Already exists
  onboardingStep: number; // New field: current step (0 = not started, -1 = completed, 1-5 = step number)
  updatedAt: Date;
}
```

**Onboarding Step Enum:**
```typescript
enum OnboardingStep {
  NOT_STARTED = 0,
  WELCOME = 1,
  ADD_CLIENT = 2,
  ADD_PROJECT = 3,
  CUSTOMIZE_COLUMNS = 4,
  CREATE_TASK = 5,
  FEATURE_TOUR = 6,
  COMPLETED = -1
}
```

**Sample Data Structure:**
- Sample clients: 2-3 clients with realistic names and rates
- Sample projects: 1-2 projects per client
- Sample columns: Default columns (Backlog, In Progress, Review, Done)
- Sample tasks: 5-10 tasks with various properties (titles, descriptions, priorities, tags)
- Sample time entries: Time entries for some tasks

### Component Specifications

**OnboardingWizard Component:**
- Location: `src/components/onboarding/OnboardingWizard.tsx`
- Should follow component template pattern from frontend architecture
- Use OnboardingContext for wizard state
- Render appropriate step component based on current step
- Show progress indicator
- Handle step navigation

**OnboardingStep Components:**
- Location: `src/components/onboarding/steps/`
- WelcomeStep.tsx, AddClientStep.tsx, AddProjectStep.tsx, CustomizeColumnsStep.tsx, CreateTaskStep.tsx, FeatureTourStep.tsx
- Each step component handles its own UI and interactions
- Use tooltip/highlight system to guide user

**OnboardingTooltip Component:**
- Location: `src/components/onboarding/OnboardingTooltip.tsx`
- Displays tooltip pointing to UI elements
- Supports positioning and arrow/pointer

**OnboardingHighlight Component:**
- Location: `src/components/onboarding/OnboardingHighlight.tsx`
- Dims background and highlights target element
- Creates spotlight effect

**SampleDataService:**
- Location: `src/services/SampleDataService.ts`
- Generates and deletes sample data
- Uses repositories to save/delete data

### File Locations

Based on project structure [Source: architecture/unified-project-structure.md]:
- Component: `src/components/onboarding/OnboardingWizard.tsx` (new)
- Components: `src/components/onboarding/steps/WelcomeStep.tsx` (new)
- Components: `src/components/onboarding/steps/AddClientStep.tsx` (new)
- Components: `src/components/onboarding/steps/AddProjectStep.tsx` (new)
- Components: `src/components/onboarding/steps/CustomizeColumnsStep.tsx` (new)
- Components: `src/components/onboarding/steps/CreateTaskStep.tsx` (new)
- Components: `src/components/onboarding/steps/FeatureTourStep.tsx` (new)
- Components: `src/components/onboarding/OnboardingTooltip.tsx` (new)
- Components: `src/components/onboarding/OnboardingHighlight.tsx` (new)
- Context: `src/contexts/OnboardingContext.tsx` (new)
- Service: `src/services/SampleDataService.ts` (new)
- Types: `src/types/settings.ts` (update existing)
- App: `src/App.tsx` (update existing)
- Settings: `src/components/settings/SettingsPanel.tsx` (update existing from Story 4.6)
- Unit tests: `tests/unit/components/onboarding/OnboardingWizard.test.tsx` (new)
- Unit tests: `tests/unit/contexts/OnboardingContext.test.tsx` (new)
- Unit tests: `tests/unit/services/SampleDataService.test.ts` (new)
- Integration tests: `tests/integration/OnboardingWorkflow.test.tsx` (new)
- E2E tests: `tests/e2e/onboarding.spec.ts` (new)

### API Specifications

**N/A - No Backend API** [Source: architecture/common/frontend-architecture.md#api-client-setup]

All onboarding operations happen client-side:
- OnboardingContext manages wizard state
- SettingsRepository persists onboarding progress to IndexedDB
- SampleDataService uses repositories to create/delete sample data
- No server-side processing needed

**Context Methods Used:**
- ClientContext: `createClient()`, `clients` (watch for new clients)
- ProjectContext: `createProject()`, `getProjectsByClientId()` (watch for new projects)
- TaskContext: `createTask()`, `tasks` (watch for new tasks)
- TimerContext: `startTimer()`, `activeTaskId` (watch for timer start)
- SettingsContext: `updateSettings()`, `settings.onboardingCompleted`, `settings.onboardingStep`
- ColumnContext: `columns` (for column customization step)

**Repository Methods Used:**
- ClientRepository: `create()` (for sample data)
- ProjectRepository: `create()` (for sample data)
- TaskRepository: `create()`, `getAll()` (for sample data, detect sample tasks)
- TimeEntryRepository: `create()` (for sample data)
- ColumnRepository: `getAll()`, `create()` (for sample data)
- SettingsRepository: `updateSettings()` (for progress persistence)

### Technical Constraints

**Wizard State Management:**
- Use OnboardingContext for wizard state
- Persist progress to Settings (onboardingStep, onboardingCompleted)
- Load progress on app mount
- Resume from saved step

**Step Detection:**
- Watch contexts for changes (clients, projects, tasks, timer)
- Auto-advance when step goal is achieved
- Allow manual advance if goal already achieved
- Handle edge cases (existing data, errors)

**Tooltip/Highlight System:**
- Use portal/overlay for tooltips and highlights
- Position tooltips relative to target elements
- Dim background and highlight target
- Ensure tooltips don't obstruct interactions
- Ensure accessibility (ARIA labels, keyboard navigation)

**Sample Data:**
- Generate realistic sample data
- Mark sample data (prefix or flag) for easy identification
- Allow deletion of all sample data
- Handle errors during generation/deletion

**Accessibility Requirements** [Source: architecture/common/accessibility-implementation.md]:
- WCAG 2.1 AA compliance required
- All interactive elements must have ARIA labels
- Keyboard navigation support (Tab, Enter/Space, Arrow keys, ESC)
- Screen reader compatibility
- Focus management (focus trap, focus restoration)
- Focus indicators visible

**Performance Requirements:**
- Smooth transitions between steps
- Efficient step detection (don't watch all contexts all the time)
- Fast sample data generation (use batch operations)

### Testing Requirements

**Unit Testing** [Source: architecture/common/testing-strategy.md#test-organization]:
- Test file locations: `tests/unit/components/onboarding/`, `tests/unit/contexts/`, `tests/unit/services/`
- Use Jest + React Testing Library
- Mock contexts and repositories
- Test wizard rendering
- Test step navigation
- Test step detection
- Test progress persistence
- Test sample data generation/deletion
- Aim for 80%+ code coverage

**Integration Testing** [Source: architecture/common/testing-strategy.md#test-organization]:
- Test file location: `tests/integration/OnboardingWorkflow.test.tsx`
- Test complete workflows with real context providers
- Test step detection and auto-advance
- Test progress persistence
- Test sample data workflow
- Use React Testing Library with full context providers

**E2E Testing** [Source: architecture/common/testing-strategy.md#test-organization]:
- Test file location: `tests/e2e/onboarding.spec.ts`
- Use Playwright for browser testing
- Test complete wizard workflow
- Test step detection and auto-advance
- Test progress persistence across reloads
- Test restart from settings
- Test sample data generation and deletion
- Test keyboard navigation

**Accessibility Testing** [Source: architecture/common/accessibility-implementation.md#accessibility-testing]:
- Use jest-axe for automated accessibility testing
- Test keyboard navigation manually
- Test with screen readers
- Verify ARIA labels are correct
- Test focus management

### Project Structure Notes

**Component Organization** [Source: architecture/common/frontend-architecture.md#component-organization]:
- Onboarding components go in `src/components/onboarding/` directory
- Step components go in `src/components/onboarding/steps/` subdirectory
- Follow existing component patterns
- Use TypeScript interfaces for props
- One component per file

**Styling** [Source: architecture/common/tech-stack.md]:
- Use Tailwind CSS ^3.4.0 for styling
- Use utility classes for responsive design
- Follow existing design patterns
- Use dark mode classes (from Story 4.5)
- Style wizard as modal overlay

**No Specific Guidance Found:**
- Tooltip positioning library preference (implement custom or use library like react-popper)
- Highlight overlay implementation (custom CSS or library)
- Sample data quantity (suggested amounts provided, but not specified)

## Testing

### Testing Standards

**Test File Location** [Source: architecture/common/testing-strategy.md#test-organization]:
- Unit tests: `tests/unit/components/onboarding/`, `tests/unit/contexts/`, `tests/unit/services/`
- Integration tests: `tests/integration/`
- E2E tests: `tests/e2e/`

**Testing Frameworks** [Source: architecture/common/tech-stack.md]:
- Jest ^29.7.0 for unit and integration testing
- React Testing Library ^14.0.0 for component testing
- Playwright ^1.40.0 for E2E testing

**Testing Patterns** [Source: architecture/common/testing-strategy.md#test-examples]:
- Use React Testing Library queries (getByRole, getByLabelText, etc.)
- Mock contexts and repositories
- Test user interactions, not implementation details
- Use proper async handling with waitFor
- Test step detection with context watching

**Accessibility Testing** [Source: architecture/common/accessibility-implementation.md#accessibility-testing]:
- Install and use jest-axe: `npm install --save-dev jest-axe`
- Add accessibility tests to component test suites
- Test keyboard navigation manually
- Test with screen readers

**Specific Testing Requirements for This Story:**
- Test wizard appears on first launch
- Test all wizard steps render correctly
- Test step navigation (next, previous, skip)
- Test step detection and auto-advance
- Test progress persistence across reloads
- Test restart from settings
- Test sample data generation and deletion
- Test keyboard navigation
- Test tooltip/highlight system
- Test accessibility

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-26 | 1.0 | Initial story draft | Scrum Master |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results

_Results from QA Agent review will be populated here after implementation_
